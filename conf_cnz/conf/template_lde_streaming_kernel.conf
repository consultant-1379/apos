# Configuration template file for 97-lde-streaming-kernel.conf drop-in.
# 97-lde-streaming-kernel.conf will be generated by lde-logm-streaming-parser and placed in /etc/rsyslog.d directory
# <VALUE> will be replaced by real value from parser

# Store messages log to local
$template kernel_dest, "<LOG_FILE>"

if ($syslogfacility-text == "kern" or ($app-name == 'kernel' and $syslogfacility-text == 'user')) then {
    if (<FILTERS>) then {
#        if ($syslogtag contains ":") then {
#            action(type="omfile" DirCreateMode="0750" FileCreateMode="0640" flushOnTXEnd="on" asyncWriting="on" flushInterval="1" dynaFile="kernel_dest" template="CBAFormat_mSec")
#        } else {
#            action(type="omfile" DirCreateMode="0750" FileCreateMode="0640" flushOnTXEnd="on" asyncWriting="on" flushInterval="1" dynaFile="kernel_dest" template="CBAFormat_mSec_AddColon")
#        }

   call dummy_ruleset

   <LOG_FORWARD>
   set $!stream_pri = $pri;
   # Customize msgid field.
   set $!stream_msgid = "<MSGID>";
   <STREAMING>
   
   # Need duplicated kernel log, so do not add stop here
    } else {
        *.* stop
    }
}
